webpackJsonp([50],{"9yiC":function(t,e,n){var i=n("ZbNu");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n("rjj0")("3035221f",i,!0)},ZbNu:function(t,e,n){(t.exports=n("FZ+f")(!1)).push([t.i,'\n.percent-tip[data-v-47bf32f2] {\n  font-size: 14px;\n}\n.percent-tip[data-v-47bf32f2]:last-of-type {\n    margin-left: 40px;\n}\n.input-number-percent[data-v-47bf32f2] {\n  margin: 0 5px;\n}\n.divide-form-inline[data-v-47bf32f2] {\n  margin: 24px 0;\n}\n.edit-input[data-v-47bf32f2] {\n  padding-right: 100px;\n}\n.cancel-btn[data-v-47bf32f2] {\n  position: absolute;\n  right: 15px;\n  top: 10px;\n}\n.tinymce-container[data-v-47bf32f2] {\n  position: relative;\n}\n.tinymce-textarea[data-v-47bf32f2] {\n  visibility: hidden;\n  z-index: -1;\n}\n.editor-custom-btn-container[data-v-47bf32f2] {\n  position: absolute;\n  right: 15px;\n  /*z-index: 2005;*/\n  top: 18px;\n}\n.editor-upload-btn[data-v-47bf32f2] {\n  display: inline-block;\n}\n.container[data-v-47bf32f2] .version-top {\n  padding: 8px 0;\n}\n.container[data-v-47bf32f2] .el-collapse-item__header {\n  height: auto;\n  line-height: 1;\n}\n.container[data-v-47bf32f2] .el-collapse-item__content {\n  padding-bottom: 0;\n}\n.container[data-v-47bf32f2] .el-collapse-item__arrow {\n  font-size: 20px;\n}\n.version-top .el-icon-edit[data-v-47bf32f2] {\n  font-size: 20px;\n  float: right;\n  margin-top: 4px;\n  margin-right: 8px;\n}\n.version[data-v-47bf32f2] {\n  line-height: 24px;\n  margin: 5px 0;\n  font-size: 24px;\n  font-weight: normal;\n}\n.v_time[data-v-47bf32f2] {\n  margin-left: 20px;\n  color: #a2a1a1;\n}\n.desc[data-v-47bf32f2] {\n  line-height: 20px;\n  font-size: 16px;\n  margin: 0 0 8px;\n}\n.subversion-list[data-v-47bf32f2] {\n  padding: 10px 0 10px 40px;\n}\n.subverison-item[data-v-47bf32f2] {\n  padding: 0 10px 10px 10px;\n  background-color: #fbfbfb;\n  position: relative;\n}\n.subverison-item[data-v-47bf32f2]::after {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 1px;\n    background-color: #f1f1f1;\n    content: "";\n}\n.tooltip-custom[data-v-47bf32f2] {\n  max-width: 300px;\n}\n.tooltip-custom p[data-v-47bf32f2] {\n    margin: 0;\n    line-height: 1.4;\n}\n',""])},vUoZ:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("woOf"),o=n.n(i),s=(n("ms7A"),n("mM5X")),a={name:"systemVersionUser",data:function(){return{loading:!1,params:{page:1,pageSize:10,beginT:"",endT:"",type:0},formInline:{type:0,v_id:0,version_ids:"",versionIds:[],is_online:"",version_num:"",title:"",content:"",online_time:""},dialogFormVisible:!1,value:"",toolbar:["removeformat undo redo |  bullist numlist | outdent indent | forecolor | fullscreen code","bold italic blockquote | h2 p  media link | alignleft aligncenter alignright"],menubar:"",height:260,hasChange:!1,hasInit:!1,edit:!1,editVersion:"",versionType:1,formRules:{versionIds:[{required:!0,trigger:"blur",message:"请选择更新类别"}],title:[{required:!0,trigger:"blur",message:"请填写更新标题"}],content:[{required:!0,trigger:"blur",message:"请填写更新内容"}],is_online:[{required:!0,trigger:"blur",message:"请选择是否上线版本"}],online_time:[{required:!0,trigger:"blur",message:"请填写上线时间"}]},total:0,versions:[],lastVersion:"",pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}}}},created:function(){this.getData()},mounted:function(){},watch:{value:function(t){var e=this;!this.hasChange&&this.hasInit&&this.$nextTick(function(){return window.tinymce.get(e.tinymceId).setContent(t)})},dialogFormVisible:function(t){var e=this;t&&this.$nextTick(function(){e.initTinymce()})}},computed:{title:function(){return!0===this.edit?"版本编辑":"版本添加"}},methods:{resetFormValue:function(){this.formInline={type:0,v_id:0,version_ids:"",versionIds:[],is_online:"",version_num:"",title:"",content:"",online_time:""},this.$refs.updateForm.resetFields()},updateVersion:function(){var t=this;this.$refs.updateForm.validate(function(e){if(!e)return console.log("error submit!!"),!1;t.formInline.version_ids=t.formInline.versionIds.join(",");var n=s.a;t.edit&&(n=s.c),n(t.formInline).then(function(e){if(e.data&&"301000"!==e.data.code)return t.$message({message:e.data.result,type:"error"});t.dialogFormVisible=!1,t.getData()})})},showDialog:function(t,e,n){if(n&&(this.formInline.v_id=n),this.dialogFormVisible=!0,this.edit=t,this.versionType=e,1===e){var i=this.lastVersion.split(".");i[0]=1+~~i[0],i[1]=0,i[2]=0,this.formInline.version_num=i.join(".")}else this.formInline.version_num=this.lastVersion},showEditDialog:function(t,e,n){var i=this;this.formInline.v_id=e,this.dialogFormVisible=!0,this.edit=t,this.versionType=n,Object(s.b)({v_id:e}).then(function(t){t.data.result.data.versionIds=t.data.result.data.version_ids.map(function(t){return~~t}),t.data.result.data.online_time=i.$options.filters.formatDateTime(t.data.result.data.online_time),i.formInline=o()({},i.formInline,t.data.result.data),console.log(i.formInline)})},versionChange:function(t){var e=this.editVersion.split(".");-1!=t.indexOf(1)&&(e[1]=1+~~e[1]),t.filter(function(t){return[2,3,4].indexOf(t)>-1}).length>0&&(e[2]=1+~~e[2]),this.formInline.version_num=e.join(".")},getData:function(){var t=this;this.loading=!0,Object(s.f)(this.params).then(function(e){t.versions=e.data.result.data,t.versions[0]?(t.versions[0].next_version.length>0?t.lastVersion=t.versions[0].next_version[0].version_num:t.lastVersion=t.versions[0].version_num,t.editVersion=t.lastVersion):(t.lastVersion="0.0.0",t.editVersion=t.lastVersion),t.loading=!1,t.total=~~e.data.result.total})},handleSizeChange:function(t){this.params.pageSize=t,this.getData()},handleCurrentChange:function(t){this.params.page=t,this.getData(),console.log("当前页: "+t)},initTinymce:function(){var t=this;if(this.hasInit)return!1;var e=this;window.tinymce.init({selector:"#view",height:this.height,body_class:"panel-body ",object_resizing:!1,toolbar:this.toolbar,menubar:this.menubar,plugins:"advlist,autolink,code,paste,textcolor, colorpicker,fullscreen,link,lists,media,wordcount, imagetools",end_container_on_empty_block:!0,powerpaste_word_import:"clean",code_dialog_height:450,code_dialog_width:1e3,advlist_bullet_styles:"square",advlist_number_styles:"default",imagetools_cors_hosts:["wpimg.wallstcn.com","wallstreetcn.com"],imagetools_toolbar:"watermark",default_link_target:"_blank",link_title:!1,init_instance_callback:function(n){e.value&&n.setContent(e.value),e.hasInit=!0,n.on("NodeChange Change KeyUp",function(){t.hasChange=!0,t.$emit("input",n.getContent({format:"raw"}))})}})},destroyTinymce:function(){window.tinymce.get(this.tinymceId)&&window.tinymce.get(this.tinymceId).destroy()},setContent:function(t){window.tinymce.get(this.tinymceId).setContent(t)},getContent:function(){window.tinymce.get(this.tinymceId).getContent()}},destroyed:function(){this.destroyTinymce()}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"container"},[n("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},nativeOn:{click:function(e){t.showDialog(!1,1)}}},[t._v("新增主版本")]),t._v(" "),n("el-tooltip",{attrs:{placement:"right"}},[n("div",{staticClass:"tooltip-custom",attrs:{slot:"content"},slot:"content"},[t.versions&&t.versions.length>0?n("p",[t._v("V"+t._s(t.versions[0].version_num))]):t._e(),t._v(" "),n("p",[t._v("第一位：主版本号，表示用户端大版本更新，新增的次版本都基于此")]),t._v(" "),n("p",[t._v("第二位：次版本号，表示用户端调整更新")]),t._v(" "),n("p",[t._v("第三位：次版本号，表示代理、商户端、平台端的更新,每一次更新都基于上一次新建的版本号")])]),t._v(" "),n("i",{staticClass:"el-icon-question"})]),t._v(" "),n("el-collapse",{staticStyle:{"margin-top":"20px"},attrs:{accordion:""}},t._l(t.versions,function(e,i){return n("el-collapse-item",{key:i},[n("template",{slot:"title"},[n("div",[n("div",{staticClass:"version-top"},[n("span",{staticClass:"version"},[t._v("V"+t._s(e.version_num))]),n("span",{staticClass:"v_time"},[t._v("创建时间："+t._s(t.$options.filters.formatDateTime(e.create_time)))]),n("i",{staticClass:"el-icon-edit",on:{click:function(n){n.stopPropagation(),t.showEditDialog(!0,e.id,1)}}})]),t._v(" "),n("p",{staticClass:"desc"},[t._v(t._s(e.title))])])]),t._v(" "),n("div",{staticClass:"subversion-list"},[n("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary",icon:"el-icon-edit"},nativeOn:{click:function(n){t.showDialog(!1,2,e.id)}}},[t._v("新增次版本")]),t._v(" "),t._l(e.next_version,function(e,i){return n("div",{key:i,staticClass:"subverison-item"},[n("div",{staticClass:"version-top"},[n("span",{staticClass:"version"},[t._v("V"+t._s(e.version_num))]),n("span",{staticClass:"v_time"},[t._v("创建时间："+t._s(t.$options.filters.formatDateTime(e.create_time)))]),n("i",{staticClass:"el-icon-edit",on:{click:function(n){n.stopPropagation(),t.showEditDialog(!0,e.id,2)}}})]),t._v(" "),n("p",{staticClass:"desc"},[t._v(t._s(e.title))])])})],2)],2)})),t._v(" "),n("div",{staticClass:"pagination-container"},[n("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),n("el-dialog",{attrs:{title:t.title,visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e},close:t.resetFormValue}},[n("el-form",{ref:"updateForm",attrs:{model:t.formInline,"label-width":"120px","status-icon":"",rules:t.formRules}},[2==t.versionType?n("el-form-item",{attrs:{label:"版本更新类别",prop:"versionIds"}},[n("el-checkbox-group",{attrs:{disabled:t.edit},on:{change:t.versionChange},model:{value:t.formInline.versionIds,callback:function(e){t.$set(t.formInline,"versionIds",e)},expression:"formInline.versionIds"}},[n("el-checkbox",{attrs:{label:1}},[t._v("用户端调整")]),t._v(" "),n("el-checkbox",{attrs:{label:2}},[t._v("商户端")]),t._v(" "),n("el-checkbox",{attrs:{label:3}},[t._v("代理端")]),t._v(" "),n("el-checkbox",{attrs:{label:4}},[t._v("平台端")])],1)],1):t._e(),t._v(" "),n("el-form-item",{attrs:{label:"版本号"}},[t._v(t._s(t.formInline.version_num)+"\n          "),2==t.versionType?n("el-tooltip",{attrs:{placement:"right"}},[n("div",{staticClass:"tooltip-custom",attrs:{slot:"content"},slot:"content"},[t.versions&&t.versions.length>0?n("p",[t._v("V"+t._s(t.versions[0].version_num))]):t._e(),t._v(" "),n("p",[t._v("第一位：主版本号，表示用户端大版本更新，新增的次版本都基于此")]),t._v(" "),n("p",[t._v("第二位：次版本号，表示用户端调整更新")]),t._v(" "),n("p",[t._v("第三位：次版本号，表示代理、商户端、平台端的更新,每一次更新都基于上一次新建的版本号")])]),t._v(" "),n("i",{staticClass:"el-icon-question"})]):t._e()],1),t._v(" "),n("el-form-item",{attrs:{label:"更新标题",prop:"title"}},[n("el-input",{attrs:{"auto-complete":"off",maxlength:"10",placeholder:"有新版本更新啦！"},model:{value:t.formInline.title,callback:function(e){t.$set(t.formInline,"title",e)},expression:"formInline.title"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"更新内容",prop:"content"}},[n("el-input",{attrs:{type:"textarea",rows:4},model:{value:t.formInline.content,callback:function(e){t.$set(t.formInline,"content",e)},expression:"formInline.content"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"是否上线版本",prop:"is_online"}},[n("el-radio",{attrs:{label:"1"},model:{value:t.formInline.is_online,callback:function(e){t.$set(t.formInline,"is_online",e)},expression:"formInline.is_online"}},[t._v("是")]),t._v(" "),n("el-radio",{attrs:{label:"0"},model:{value:t.formInline.is_online,callback:function(e){t.$set(t.formInline,"is_online",e)},expression:"formInline.is_online"}},[t._v("否")])],1),t._v(" "),n("el-form-item",{attrs:{label:"上线时间",prop:"online_time"}},[n("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":t.pickerOptions},model:{value:t.formInline.online_time,callback:function(e){t.$set(t.formInline,"online_time",e)},expression:"formInline.online_time"}})],1)],1),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.updateVersion}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var r=n("VU/8")(a,l,!1,function(t){n("9yiC")},"data-v-47bf32f2",null);e.default=r.exports}});